{% extends "base.html" %} {% block content %}
<div class="container-fluid redesign-page py-4 py-lg-5">
    <div class="row justify-content-center">
        <div class="col-xl-7 col-lg-9 col-md-11">
            <!-- Header -->
            <header class="text-center mb-4">
                <h1 class="display-2 page-title text-primary">
                    <i class="bi bi-cloud-arrow-down-fill"></i>
                </h1>
                <p class="lead subtitle-text">
                    Download any streaming media on your browser.
                </p>
            </header>

            <!-- Main Control Card -->
            <div class="card shadow-lg mb-4">
                <div class="card-body p-lg-5 p-4">
                    <!-- JSON Configuration -->
                    <div id="jsonMode" class="mode-section active">
                        <h5 class="card-title mb-3 fw-semibold">
                            <i class="bi bi-braces me-2"></i>JSON Configuration
                        </h5>
                        <div class="mb-3">
                            <textarea
                                class="form-control"
                                id="jsonInput"
                                rows="4"
                                placeholder='{
  "url": "https://example.com/video.m3u8",
  "sourceType": "hls",
  "headers": {"Authorization": "Bearer token"},
  "cookies": "session_id=abc123; auth_token=xyz789",
  "userAgent": "Mozilla/5.0...",
  "referer": "https://example.com/page"
}

// Or for YouTube:
{
  "url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
  "sourceType": "youtube"
}'
                            ></textarea>
                            <div
                                class="d-flex justify-content-between align-items-center mt-2"
                            >
                                <div class="form-text">
                                    Paste JSON from the Chrome extension
                                </div>
                                <div id="jsonValidation"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Download Options -->
                    <div class="mt-4">
                        <h5 class="card-title mb-3 fw-semibold">
                            <i class="bi bi-sliders me-2"></i>Download Options
                        </h5>
                        <!-- Simple Options -->
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="quality" class="form-label"
                                    >Quality</label
                                >
                                <select class="form-select" id="quality">
                                    <option value="1080p">
                                        1080p (Full HD)
                                    </option>
                                    <option value="720p" selected>
                                        720p (HD)
                                    </option>
                                    <option value="480p">480p (SD)</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="format" class="form-label"
                                    >Format</label
                                >
                                <select class="form-select" id="format">
                                    <option value="mp4">MP4 (Universal)</option>
                                    <option value="webm">
                                        WebM (Optimized)
                                    </option>
                                    <option value="mkv">MKV (Quality)</option>
                                    <option value="mov">MOV (Apple)</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="filename" class="form-label"
                                    >Custom Filename</label
                                >
                                <input
                                    type="text"
                                    class="form-control"
                                    id="filename"
                                    placeholder="Optional (no extension)"
                                />
                            </div>
                        </div>

                        <!-- Advanced Options Accordion -->
                        <div
                            class="accordion accordion-flush mt-3"
                            id="advancedAccordion"
                        >
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingOne">
                                    <button
                                        class="accordion-button collapsed px-1"
                                        type="button"
                                        data-bs-toggle="collapse"
                                        data-bs-target="#advancedOptions"
                                        aria-expanded="false"
                                        aria-controls="advancedOptions"
                                    >
                                        <i
                                            class="bi bi-gear-wide-connected me-2"
                                        ></i
                                        >Advanced Options
                                    </button>
                                </h2>
                                <div
                                    id="advancedOptions"
                                    class="accordion-collapse collapse"
                                    aria-labelledby="headingOne"
                                    data-bs-parent="#advancedAccordion"
                                >
                                    <div class="accordion-body">
                                        <h6 class="subtitle-text fw-normal">
                                            Fine-tune your download settings for
                                            maximum control.
                                        </h6>

                                        <!-- Options -->
                                        <div class="row g-3 mt-2">
                                            <div class="col-md-3">
                                                <label
                                                    for="videoQualityAdvanced"
                                                    class="form-label"
                                                    >Specific Quality</label
                                                ><select
                                                    class="form-select"
                                                    id="videoQualityAdvanced"
                                                >
                                                    <option value="">
                                                        Use Simple
                                                    </option>
                                                    <option value="2160p">
                                                        4K
                                                    </option>
                                                    <option value="1440p">
                                                        2K
                                                    </option>
                                                    <option value="1080p60">
                                                        1080p60
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label
                                                    for="audioQuality"
                                                    class="form-label"
                                                    >Audio Quality</label
                                                ><select
                                                    class="form-select"
                                                    id="audioQuality"
                                                >
                                                    <option value="best">
                                                        Best
                                                    </option>
                                                    <option value="192k">
                                                        192k
                                                    </option>
                                                    <option value="128k">
                                                        128k
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label
                                                    for="audioFormat"
                                                    class="form-label"
                                                    >Audio Format</label
                                                ><select
                                                    class="form-select"
                                                    id="audioFormat"
                                                >
                                                    <option value="best">
                                                        Best
                                                    </option>
                                                    <option value="aac">
                                                        AAC
                                                    </option>
                                                    <option value="mp3">
                                                        MP3
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <label
                                                    for="containerAdvanced"
                                                    class="form-label"
                                                    >Adv. Formats</label
                                                ><select
                                                    class="form-select"
                                                    id="containerAdvanced"
                                                >
                                                    <option value="">
                                                        Use Simple
                                                    </option>
                                                    <option value="avi">
                                                        AVI
                                                    </option>
                                                    <option value="flv">
                                                        FLV
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label
                                                    for="subtitleLangs"
                                                    class="form-label"
                                                    >Subtitle Languages</label
                                                ><input
                                                    type="text"
                                                    class="form-control"
                                                    id="subtitleLangs"
                                                    placeholder="en,es,fr or 'all'"
                                                />
                                            </div>
                                            <div class="col-md-3">
                                                <label
                                                    for="subtitleFormat"
                                                    class="form-label"
                                                    >Subtitle Format</label
                                                ><select
                                                    class="form-select"
                                                    id="subtitleFormat"
                                                >
                                                    <option value="best">
                                                        Best
                                                    </option>
                                                    <option value="srt">
                                                        SRT
                                                    </option>
                                                    <option value="vtt">
                                                        VTT
                                                    </option>
                                                </select>
                                            </div>
                                            <div
                                                class="col-md-3 d-flex align-items-end"
                                            >
                                                <div class="form-check">
                                                    <input
                                                        class="form-check-input"
                                                        type="checkbox"
                                                        id="autoSubs"
                                                    /><label
                                                        class="form-check-label"
                                                        for="autoSubs"
                                                        >Auto-Subs</label
                                                    >
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Toggles -->
                                        <div class="row mt-3 g-3">
                                            <div class="col-6 col-md-3">
                                                <div
                                                    class="form-check form-switch"
                                                >
                                                    <input
                                                        class="form-check-input"
                                                        type="checkbox"
                                                        id="extractAudio"
                                                    /><label
                                                        class="form-check-label"
                                                        for="extractAudio"
                                                        >Audio Only</label
                                                    >
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div
                                                    class="form-check form-switch"
                                                >
                                                    <input
                                                        class="form-check-input"
                                                        type="checkbox"
                                                        id="embedSubs"
                                                    /><label
                                                        class="form-check-label"
                                                        for="embedSubs"
                                                        >Embed Subs</label
                                                    >
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div
                                                    class="form-check form-switch"
                                                >
                                                    <input
                                                        class="form-check-input"
                                                        type="checkbox"
                                                        id="embedThumbnail"
                                                    /><label
                                                        class="form-check-label"
                                                        for="embedThumbnail"
                                                        >Thumbnail</label
                                                    >
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div
                                                    class="form-check form-switch"
                                                >
                                                    <input
                                                        class="form-check-input"
                                                        type="checkbox"
                                                        id="embedMetadata"
                                                    /><label
                                                        class="form-check-label"
                                                        for="embedMetadata"
                                                        >Metadata</label
                                                    >
                                                </div>
                                            </div>
                                            <div class="col-6 col-md-3">
                                                <div
                                                    class="form-check form-switch"
                                                >
                                                    <input
                                                        class="form-check-input"
                                                        type="checkbox"
                                                        id="verbose"
                                                    /><label
                                                        class="form-check-label"
                                                        for="verbose"
                                                        >Verbose Log</label
                                                    >
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Download Button -->
            <div class="d-grid gap-2 mb-4">
                <button
                    type="button"
                    class="btn btn-primary btn-lg shadow-sm"
                    id="downloadBtn"
                    disabled
                >
                    <i class="bi bi-cloud-download me-2"></i>Start Download
                </button>
                <small class="text-center subtitle-text" id="downloadBtnHelp"
                    >Enter valid JSON to enable download</small
                >
            </div>

            <!-- Status Sections -->
            <div
                id="progressContainer"
                class="card shadow-sm mb-4"
                style="display: none"
            >
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div
                            class="spinner-border text-primary me-3"
                            role="status"
                            id="loadingSpinner"
                        ></div>
                        <div>
                            <h5 class="card-title mb-0" id="statusMessage">
                                Initializing...
                            </h5>
                            <small class="subtitle-text" id="statusDetails"
                                >Please wait.</small
                            >
                        </div>
                        <button
                            type="button"
                            class="btn-close ms-auto"
                            aria-label="Cancel"
                            id="cancelBtn"
                        ></button>
                    </div>
                    <div class="progress" style="height: 8px">
                        <div
                            class="progress-bar progress-bar-striped progress-bar-animated"
                            id="progressBar"
                            role="progressbar"
                            style="width: 0%"
                            aria-valuenow="0"
                            aria-valuemin="0"
                            aria-valuemax="100"
                        ></div>
                    </div>
                </div>
            </div>
            <div
                id="downloadSection"
                class="card shadow-sm text-center p-4"
                style="display: none"
            >
                <div class="card-body">
                    <i
                        class="bi bi-check-circle-fill text-success display-3 mb-3"
                    ></i>
                    <h5 class="card-title">Download Complete!</h5>
                    <p class="subtitle-text">
                        Your video is ready to be saved.
                    </p>
                    <div
                        class="d-grid gap-2 d-sm-flex justify-content-sm-center"
                    >
                        <button
                            type="button"
                            class="btn btn-success btn-lg"
                            id="downloadFileBtn"
                        >
                            <i class="bi bi-download me-2"></i>Download File</button
                        ><button
                            type="button"
                            class="btn btn-outline-secondary"
                            id="newDownloadBtn"
                        >
                            <i class="bi bi-plus-circle me-2"></i>Start New
                        </button>
                    </div>
                </div>
            </div>
            <div
                id="errorSection"
                class="alert alert-danger d-flex align-items-center shadow-sm"
                style="display: none !important"
            >
                <i
                    class="bi bi-exclamation-triangle-fill flex-shrink-0 me-3"
                ></i>
                <div>
                    <h6 class="alert-heading">Download Failed</h6>
                    <span id="errorMessage"></span>
                </div>
                <button
                    type="button"
                    class="btn btn-outline-danger btn-sm ms-auto"
                    id="retryBtn"
                >
                    <i class="bi bi-arrow-clockwise me-1"></i>Retry
                </button>
            </div>

            <!-- History and Status -->
            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title mb-3 fw-semibold">
                                <i class="bi bi-clock-history me-2"></i>History
                            </h5>
                            <div
                                id="jobHistory"
                                class="job-history flex-grow-1"
                            >
                                <p class="text-center mt-3 subtitle-text">
                                    No recent downloads
                                </p>
                            </div>
                            <div class="d-flex gap-2 mt-3 border-top pt-3">
                                <button
                                    type="button"
                                    class="btn btn-sm btn-outline-secondary"
                                    id="refreshHistoryBtn"
                                >
                                    <i class="bi bi-arrow-clockwise"></i>
                                    Refresh</button
                                ><button
                                    type="button"
                                    class="btn btn-sm btn-outline-danger"
                                    id="clearHistoryBtn"
                                >
                                    <i class="bi bi-trash"></i> Clear
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title mb-3 fw-semibold">
                                <i class="bi bi-hdd-stack me-2"></i>System
                                Status
                            </h5>
                            <div class="vstack gap-3">
                                <div class="d-flex align-items-center">
                                    <i
                                        class="bi bi-youtube fs-4 me-3 text-danger"
                                    ></i>
                                    <div class="flex-grow-1">
                                        <div class="fw-medium">yt-dlp</div>
                                        <small class="subtitle-text"
                                            >Downloader Engine</small
                                        >
                                    </div>
                                    <span
                                        class="badge rounded-pill {% if dependencies['yt-dlp'] %}bg-success-subtle text-success-emphasis{% else %}bg-danger-subtle text-danger-emphasis{% endif %}"
                                        >{% if dependencies['yt-dlp'] %}Ready{%
                                        else %}Missing{% endif %}</span
                                    >
                                </div>
                                <div class="d-flex align-items-center">
                                    <i
                                        class="bi bi-film fs-4 me-3 text-primary"
                                    ></i>
                                    <div class="flex-grow-1">
                                        <div class="fw-medium">FFmpeg</div>
                                        <small class="subtitle-text"
                                            >Media Processing</small
                                        >
                                    </div>
                                    <span
                                        class="badge rounded-pill {% if dependencies['ffmpeg'] %}bg-success-subtle text-success-emphasis{% else %}bg-warning-subtle text-warning-emphasis{% endif %}"
                                        >{% if dependencies['ffmpeg'] %}Ready{%
                                        else %}Optional{% endif %}</span
                                    >
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/downloader.js') }}"></script>
{% endblock %}
