<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{% block title %}Media Downloader{% endblock %}</title>

        <!-- Favicon -->
        <link
            rel="icon"
            type="image/svg+xml"
            href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23007bff' class='bi bi-download' viewBox='0 0 16 16'%3E%3Cpath d='M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z'/%3E%3Cpath d='M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z'/%3E%3C/svg%3E"
        />

        <!-- Bootstrap CSS & Icons -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
            rel="stylesheet"
        />

        <!-- Consolidated Theming Styles -->
        <style>
            /* 1. THEME DEFINITION */
            :root {
                --page-bg: #ffffff;
                --card-bg: #ffffff;
                --text-primary: #212529;
                --text-secondary: #6c757d;
                --border-color: #dee2e6;
                --input-bg: #ffffff;
                --input-border: #ced4da;
                --shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
                --accent-primary: #0d6efd;
                --nav-bg: #0d6efd;
            }

            html[data-theme="dark"] {
                --page-bg: #121212;
                --card-bg: #1e1e1e;
                --text-primary: #e9ecef;
                --text-secondary: #adb5bd;
                --border-color: #343a40;
                --input-bg: #2c2c2c;
                --input-border: #495057;
                --shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.3);
                --accent-primary: #3b82f6;
                --nav-bg: #212529;
            }

            /* 2. GLOBAL STYLES */
            body {
                background-color: var(--page-bg);
                color: var(--text-primary);
                transition:
                    background-color 0.2s ease-in-out,
                    color 0.2s ease-in-out;
            }
            .redesign-page {
                background-color: var(--page-bg);
            }
            .page-title,
            .card-title,
            h1,
            h2,
            h3,
            h4,
            h5,
            h6,
            .fw-medium,
            .form-label {
                color: var(--text-primary);
            }
            .subtitle-text,
            .text-muted,
            .form-text {
                color: var(--text-secondary);
            }
            .navbar.bg-primary {
                background-color: var(--nav-bg) !important;
                transition: background-color 0.2s ease-in-out;
            }

            /* 3. COMPONENT STYLING */
            .card {
                background-color: var(--card-bg);
                border: 1px solid var(--border-color);
                box-shadow: none;
                transition: all 0.2s ease-in-out;
            }
            .card:hover {
                transform: translateY(-3px);
                box-shadow: var(--shadow);
            }
            .form-control,
            .form-select {
                background-color: var(--input-bg);
                color: var(--text-primary);
                border-color: var(--input-border);
            }
            .form-control::placeholder {
                color: var(--text-secondary);
                opacity: 0.8;
            }
            .form-control:focus,
            .form-select:focus {
                background-color: var(--input-bg);
                color: var(--text-primary);
                border-color: var(--accent-primary);
                box-shadow: 0 0 0 0.25rem rgba(var(--accent-primary), 0.25);
            }
            .accordion-item,
            .accordion-button {
                background-color: transparent;
                color: var(--text-primary);
            }
            .accordion-flush .accordion-item {
                border-bottom-color: var(--border-color);
            }
            .accordion-button:not(.collapsed) {
                color: var(--accent-primary);
                box-shadow: none;
            }
            .accordion-button:focus {
                box-shadow: none;
                border-color: transparent;
            }

            /* 4. UTILITY & THEME-SPECIFIC FIXES */
            #themeToggle {
                cursor: pointer;
            }
            #themeIcon {
                color: white;
                margin-left: 0.5rem;
                vertical-align: middle;
            }
            html[data-theme="dark"] .btn-close {
                filter: invert(1) grayscale(100) brightness(200%);
            }
            html[data-theme="dark"] .accordion-button::after {
                filter: brightness(0) invert(1);
            }
            html[data-theme="dark"] .badge.bg-success-subtle {
                background-color: #0a3d2b !important;
                color: #23e8a3 !important;
            }
            html[data-theme="dark"] .badge.bg-danger-subtle {
                background-color: #4d1b26 !important;
                color: #f76f8c !important;
            }
            html[data-theme="dark"] .badge.bg-warning-subtle {
                background-color: #4d3a14 !important;
                color: #f5c150 !important;
            }
            
            /* History section dark theme styles */
            html[data-theme="dark"] .history-item {
                background-color: var(--card-bg) !important;
                border-color: var(--border-color) !important;
                color: var(--text-primary) !important;
            }
            html[data-theme="dark"] .history-item:hover {
                background-color: #2c2c2c !important;
            }
            html[data-theme="dark"] .history-title {
                color: var(--text-primary) !important;
            }
            html[data-theme="dark"] .history-item .text-muted {
                color: var(--text-secondary) !important;
            }
        </style>
        
        <!-- Theme initialization script -->
        <script src="{{ url_for('static', filename='js/theme-init.js') }}"></script>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container-fluid">
                <div class="navbar-nav" style="width: 56px">
                    <!-- Left spacer to balance the toggle -->
                </div>
                <a class="navbar-brand mx-auto" href="{{ url_for('index') }}">
                    <i class="bi bi-download"></i>
                    Media Downloader
                </a>
                <div class="navbar-nav" style="width: 56px">
                    <div
                        class="form-check form-switch d-flex align-items-center ms-auto"
                    >
                        <input
                            class="form-check-input"
                            type="checkbox"
                            id="themeToggle"
                            title="Toggle theme"
                        />
                        <label class="form-check-label" for="themeToggle">
                            <i class="bi" id="themeIcon"></i>
                        </label>
                    </div>
                </div>
            </div>
        </nav>

        {% block content %}{% endblock %}

        <!-- No jQuery needed anymore, using CSS transitions instead -->
        
        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Theme Toggle Script -->
        <script src="{{ url_for('static', filename='js/theme.js') }}"></script>

        {% block scripts %}{% endblock %}
    </body>
</html>
